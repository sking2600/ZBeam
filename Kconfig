# ZBeam Application Configuration

# ============================================================================
# MCU/Platform-Specific Configuration
# ============================================================================
menu "MCU-Specific Settings"

menu "PWM Ramp Table"

config PWM_RAMP_TABLE
	bool "Enable PWM ramp table for LED brightness"
	default y
	help
	  Enable perception-corrected PWM ramp table for LED brightness control.
	  Uses gamma correction for perceptually-linear brightness changes.

if PWM_RAMP_TABLE

config PWM_RAMP_RESOLUTION_13BIT
	bool
	default y if SOC_SERIES_ESP32C3 || SOC_SERIES_ESP32 || SOC_SERIES_ESP32S2 || SOC_SERIES_ESP32S3 || SOC_SERIES_NRF52X

config PWM_RAMP_RESOLUTION_10BIT
	bool
	default y if SOC_SERIES_STM32F4X || SOC_SERIES_STM32L4X

config PWM_RAMP_RESOLUTION_8BIT
	bool
	default y if !PWM_RAMP_RESOLUTION_13BIT && !PWM_RAMP_RESOLUTION_10BIT

config PWM_RAMP_ESP32_LEDC_INTERPOLATION
	bool
	default y if SOC_SERIES_ESP32C3 || SOC_SERIES_ESP32 || SOC_SERIES_ESP32S2 || SOC_SERIES_ESP32S3

config PWM_RAMP_INTERPOLATION_STEP
	int "Ramp table interpolation step size"
	default 8
	range 1 64
	depends on PWM_RAMP_ESP32_LEDC_INTERPOLATION
	help
	  Instead of updating brightness at every table index, skip N entries
	  and use LEDC hardware fade to interpolate between values.
	  Higher values = less CPU overhead, but coarser gamma correction.
	  Recommended: 4-16 for smooth fades with minimal CPU usage.

config PWM_RAMP_DMA
	bool "Use DMA for PWM ramping"
	default n
	help
	  Use DMA to transfer duty values from the ramp table directly
	  to the timer's Capture/Compare Register. This provides true
	  zero-CPU-overhead brightness ramping on MCUs with Timer+DMA.
	  Currently a stub - requires hardware-specific implementation.

endif # PWM_RAMP_TABLE

endmenu # PWM Ramp Table

endmenu # MCU-Specific Settings

# ============================================================================
# General Application Configuration
# ============================================================================
menu "ZBeam Application"

menu "Input Handling"

config ZBEAM_CLICK_TIMEOUT_MS
	int "Multi-tap click timeout (ms)"
	default 500
	help
	  Time window to wait for additional clicks before finalizing a tap sequence.

config ZBEAM_HOLD_DURATION_MS
	int "Hold detection threshold (ms)"
	default 500
	help
	  Duration button must be held to register as a hold event.

config ZBEAM_MAX_NAV_SLOTS
	int "Maximum tap count for navigation"
	default 10
	range 1 10

	help
	  Maximum number of sequential taps supported for navigation.
	  Index 0 = 1 tap, Index 6 = 7 taps (AUX config).

endmenu # Input Handling

menu "Worker Threads"

config ZBEAM_FSM_MSGQ_DEPTH
	int "FSM message queue depth"
	default 8
	range 4 32
	help
	  Number of pending messages before queue blocks.
	  Should handle bursts of input + timer events.

config ZBEAM_FSM_WORKER_STACK_SIZE
	int "FSM worker thread stack size (bytes)"
	default 1024
	range 512 4096
	help
	  Stack size for FSM worker thread. Use thread analyzer to tune.

config ZBEAM_FSM_WORKER_PRIORITY
	int "FSM worker thread priority"
	default 7
	range 0 14
	help
	  Cooperative priority. Lower number = higher priority.

config ZBEAM_SAFETY_WORKER_STACK_SIZE
	int "Safety worker thread stack size (bytes)"
	default 512
	range 256 2048
	help
	  Stack size for safety monitor thread. Minimal - only reads sensors.

config ZBEAM_SAFETY_RATE_HZ
	int "Safety monitor check frequency (Hz)"
	default 10
	range 1 100
	help
	  How often the safety monitor reads sensors and checks limits.

endmenu # Worker Threads

menu "Safety Thresholds"

config ZBEAM_TEMP_WARN_C10
	int "Temperature warning threshold (0.1°C units)"
	default 600
	range 300 800
	help
	  Temperature at which thermal warning is triggered.
	  Value is in 0.1°C units (600 = 60.0°C).
	  FSM will begin gradual power reduction.

config ZBEAM_TEMP_SHUTDOWN_C10
	int "Temperature shutdown threshold (0.1°C units)"
	default 750
	range 500 900
	help
	  Temperature at which emergency shutdown is triggered.
	  Value is in 0.1°C units (750 = 75.0°C).
	  Conservative default for LED longevity.

config ZBEAM_CURRENT_MAX_MA
	int "Maximum current (mA)"
	default 2500
	range 500 5000
	help
	  Current at which emergency shutdown is triggered.
	  Default 2500mA (2.5A) is conservative for most LEDs.

config ZBEAM_VOLTAGE_MIN_MV
	int "Minimum voltage (mV)"
	default 2900
	range 2500 3200
	help
	  Voltage below which emergency shutdown is triggered.
	  Default 2900mV is safe LiPo cutoff.

config ZBEAM_VOLTAGE_MAX_MV
	int "Maximum voltage (mV)"
	default 4200
	range 4000 4500
	help
	  Voltage above which emergency shutdown is triggered.
	  Default 4200mV is standard LiPo full charge.

endmenu # Safety Thresholds

menu "Default UI Settings"

config ZBEAM_DEFAULT_UI_MODE_ADVANCED
	bool "Default to Advanced UI"
	default n
	help
	  If enabled, the light starts in Advanced UI mode.
	  If disabled, it starts in Simple UI mode.

choice ZBEAM_DEFAULT_MEMORY_MODE
	prompt "Default Memory Mode"
	default ZBEAM_MEMORY_AUTOMATIC
	help
	  Select the default memory behavior for brightness.

	config ZBEAM_MEMORY_AUTOMATIC
		bool "Automatic (Last Used)"
	
	config ZBEAM_MEMORY_MANUAL
		bool "Manual (Set Level)"
	
	config ZBEAM_MEMORY_HYBRID
		bool "Hybrid (Timer-based)"
endchoice

config ZBEAM_DEFAULT_MANUAL_MEM_LEVEL
	int "Default Manual Memory Level (1-255)"
	default 128
	range 1 255
	depends on ZBEAM_DEFAULT_MEMORY_MODE != ZBEAM_MEMORY_AUTOMATIC

config ZBEAM_DEFAULT_HYBRID_MEM_TIMEOUT_MIN
	int "Default Hybrid Memory Timeout (Minutes)"
	default 10
	depends on ZBEAM_DEFAULT_MEMORY_MODE = ZBEAM_MEMORY_HYBRID

config ZBEAM_AUTO_LOCK_TIMEOUT_MIN
	int "Auto-Lock Timeout (Minutes, 0=Disabled)"
	default 0
	help
	  Automatic lockout after inactivity.

endmenu # Default UI Settings

menu "Ramp Configuration"

choice ZBEAM_DEFAULT_RAMP_STYLE
	prompt "Default Ramp Style"
	default ZBEAM_RAMP_SMOOTH
	help
	  Select if the light starts with Smooth or Stepped ramping.

	config ZBEAM_RAMP_SMOOTH
		bool "Smooth (Continuous)"
	
	config ZBEAM_RAMP_STEPPED
		bool "Stepped (Discrete)"
endchoice

config ZBEAM_STEPPED_RAMP_STEPS
	int "Number of steps in Stepped Ramp"
	default 7
	range 2 150
	help
	  Total number of levels in stepped mode (evenly spaced between floor and ceiling).

endmenu # Ramp Configuration

menu "LED Control"

config ZBEAM_PWM_VALUES
	string "Comma-separated PWM levels (0-255)"
	default "1,10,40,75,100,150,200,255"
	help
	  Discrete brightness levels for ramp mode.

config ZBEAM_MAX_PWM_LEVELS
	int "Maximum number of PWM levels"
	default 16
	range 2 32
	help
	  Maximum entries parsed from ZBEAM_PWM_VALUES.

config ZBEAM_STROBE_MIN_FREQ
    int "Minimum Strobe Frequency (Hz)"
    default 2
    help
      Minimum strobe frequency (slowest).

config ZBEAM_STROBE_MAX_FREQ
    int "Maximum Strobe Frequency (Hz)"
    default 80
    help
      Maximum strobe frequency (fastest).

config ZBEAM_STROBE_DEFAULT_FREQ
    int "Default Strobe Frequency (Hz)"
    default 12
    help
      Default strobe frequency on boot/reset.

config ZBEAM_STROBE_WAVEFORM_SAWTOOTH
    bool "Use Sawtooth Wave Strobe"
    default y
    help
      If enabled, strobe uses a sawtooth waveform (Ramp Up -> Hard Drop) logic.
      Uses software segmentation to approximate the shape.

config ZBEAM_STROBE_USE_ALC_BRIGHTNESS
    bool "Use Active Level for Strobe Brightness"
    default y
    help
      If enabled, strobe flashes at the current brightness level (memorized).
      If disabled, strobe always flashes at 100% (255).

config ZBEAM_BRIGHTNESS_FLOOR
    int "Brightness Floor (1-255)"
    default 1
    range 1 255

config ZBEAM_BRIGHTNESS_CEILING
    int "Brightness Ceiling (1-255)"
    default 255
    range 1 255

config ZBEAM_BRIGHTNESS_SWEEP_DURATION_MS
    int "Brightness Sweep Duration (ms)"
    default 2000
    help
      Time to sweep brightness from floor to ceiling.

config ZBEAM_STROBE_SWEEP_DURATION_MS
    int "Strobe Sweep Duration (ms)"
    default 3000
    help
      Time to sweep strobe frequency from min to max.

menu "Thermal Manager"
	config ZBEAM_THERMAL_LIMIT_DEFAULT
		int "Default Thermal Limit (C)"
		default 45
		help
		  Target temperature for temperature regulation.

	config ZBEAM_PID_KP
		int "PID Kp (Proportional) x100"
		default 50
		help
		  Proportional gain scaled by 100.

	config ZBEAM_PID_KI
		int "PID Ki (Integral) x100"
		default 2
		help
		  Integral gain scaled by 100.
	
	config ZBEAM_PID_KD
		int "PID Kd (Derivative) x100"
		default 100
		help
		  Derivative gain scaled by 100.
endmenu


config ZBEAM_SWEEP_DURATION_MS
	int "Sweep Duration (ms)"
	default 2000
	help
	  Time to sweep from floor to ceiling.

config ZBEAM_SWEEP_SPEED_MS
	int "Sweep cycle speed (ms per step)"
	default 10
	range 1 100
	help
	  Time per step in sweep/breathing mode.

config ZBEAM_BLINK_RETURN_MS
	int "Blink node auto-return timeout (ms)"
	default 200
	help
	  How long to stay in blink state before returning.

endmenu # LED Control

menu "AUX LED Controller"
config ZBEAM_AUX_TYPE_SINGLE
	bool
	default y if !ZBEAM_AUX_TYPE_RGB && !ZBEAM_AUX_TYPE_WS2812

config ZBEAM_AUX_TYPE_RGB
	bool
	default n

config ZBEAM_AUX_TYPE_WS2812
	bool
	default n

	config ZBEAM_AUX_BLINK_SPEED_MS
		int "AUX Blink Speed (ms)"
		default 1000
		help
		  Pulse duration for AUX blinking mode.
endmenu


menu "Debug and Profiling"

config ZBEAM_THREAD_ANALYZER
	bool "Enable thread stack profiling"
	select THREAD_ANALYZER
	select THREAD_ANALYZER_AUTO
	select INIT_STACKS
	help
	  Enables periodic reporting of thread stack usage
	  to verify stack sizes are not over-provisioned.
	  Note: Manually set CONFIG_THREAD_ANALYZER_USE_LOG=y in prj.conf.

config ZBEAM_THREAD_ANALYZER_INTERVAL_SEC
	int "Thread analyzer report interval (seconds)"
	default 30
	range 5 300
	depends on ZBEAM_THREAD_ANALYZER
	help
	  Interval between thread analyzer reports.

endmenu # Debug and Profiling

menu "Data Storage"

config ZBEAM_NVS_ENABLED
	bool "Enable NVS Storage"
	default n
	select FLASH
	select FLASH_MAP
	select NVS
	help
	  Enable Non-Volatile Storage (NVS) for persisting settings.

endmenu # Data Storage

endmenu # ZBeam Application

source "Kconfig.zephyr"
